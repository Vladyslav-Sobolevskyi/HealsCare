class Visit{constructor(t,e,o,i,s,r){this.data={},this.api=o,this.filter=s,this.newVisit=i,this.form=t,this.modal=e,this.loader=r}visitForm(t){console.log("visitForm called"),console.log(this.form),console.log(this.modal);const e={};this.form._clearForm();const o=this.form.form,i=this.form.formHeader,s=this.form.formBody,r=this.form.formFooter,n=document.createElement("h2");n.className="form__title",n.textContent=t?"Editing visit!":"Creating new visit!";const a=this.form._renderSelect({id:"statusVisit",className:"form__select",options:[{className:"select__option",value:"open",textContent:"Open"},{className:"select__option",value:"done",textContent:"Done"}]}),l=this.form._renderSelect({id:"choosingDoctor",className:"form__select",options:[{className:"select__option",value:"",textContent:"Choose a doctor..."},{className:"select__option",value:"therapist",textContent:"Therapist"},{className:"select__option",value:"cardiologist",textContent:"Cardiologist"},{className:"select__option",value:"dentist",textContent:"Dentist"}]}),c=this.form._renderSelect({id:"urgencyVisit",className:"form__select",options:[{className:"select__option",value:"regular",textContent:"Regular"},{className:"select__option",value:"priority",textContent:"Priority"},{className:"select__option",value:"urgent",textContent:"Urgent"}]}),d=this.form._renderField("nameVisitor","Visitor name","text","Enter visitor name:",!0);d.querySelector("input").value=t?.nameVisitor||"";const m=this.form._renderField("descriptionVisit","Description of the visit","text","Enter description of the visit:",!0);m.querySelector("input").value=t?.descriptionVisit||"";const h=this.form._renderField("briefDescriptionVisit","Brief description of the visit","text","Enter a brief description of the visit:",!0);h.querySelector("input").value=t?.briefDescriptionVisit||"";const u=document.createElement("div");u.className="form__additional";const _=this.form._renderButton("submit","form__button form__button--create",t?"Edit visit":"Create new visit"),f=this.form._renderCancelButton();o.addEventListener("submit",(async i=>{i.preventDefault(),this.loader.toggle(!0);if(!o.querySelector("#choosingDoctor").value)return alert("Please choose a doctor before submitting."),void this.loader.toggle(!1);if(o.querySelectorAll("input, select, textarea").forEach((t=>{const o=t.id,i=t.value;o&&(e[o]=i)})),e.id=t?t.id:"",t){console.log("new",e);const t=await this.api.editVisit(e);console.log("edit",t),this.newVisit.editCards(t)}else{const t=await this.api.createVisit(e);console.log("newVisit",t),this.filter.setNewCard(t)}this.modal.close()})),i.append(n),s.append(a,l,c,d,m,h,u),r.append(_,f),t&&(l.value=t.choosingDoctor,this._handleDoctorChange(t.choosingDoctor,s,t),l.disabled=!0,a.value=t.statusVisit,c.value=t.urgencyVisit),l.addEventListener("change",(()=>{this._handleDoctorChange(l.value,s)})),this.modal.open(o)}_handleDoctorChange(t,e,o){const i=e.querySelector(".form__additional");i.innerHTML="",t&&import("../../../js/components/Visit/VisitFactory.js").then((({getVisitByDoctor:e})=>{const s=e(t,this.form,this.modal);s&&"function"==typeof s._renderDoctorFields&&s._renderDoctorFields(i,o)}))}}export default Visit;